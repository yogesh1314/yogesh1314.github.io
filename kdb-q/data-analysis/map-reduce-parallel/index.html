
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Personal Blog to document my experiments with tech">
      
      
      
        <link rel="canonical" href="https://yogesh1314.github.io/kdb-q/data-analysis/map-reduce-parallel/">
      
      <link rel="icon" href="../../../static/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.9">
    
    
      
        <title>Map Reduce Parallelization - Tech Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2b4465f4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../stylesheets/prism.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#without-slave-processes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Tech Blog" class="md-header__button md-logo" aria-label="Tech Blog" data-md-component="logo">
      
  <img src="../../../static/YR.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tech Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Map Reduce Parallelization
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/yogesh1314/yogesh1314-mkdocs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    yogesh1314-mkdocs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../atom-lists/basic_operations/" class="md-tabs__link md-tabs__link--active">
        KDB-q
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../aoc/23/" class="md-tabs__link">
        Advent-of-Code
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Tech Blog" class="md-nav__button md-logo" aria-label="Tech Blog" data-md-component="logo">
      
  <img src="../../../static/YR.svg" alt="logo">

    </a>
    Tech Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/yogesh1314/yogesh1314-mkdocs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    yogesh1314-mkdocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          KDB-q
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="KDB-q" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          KDB-q
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Atom-lists
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Atom-lists" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Atom-lists
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../atom-lists/basic_operations/" class="md-nav__link">
        Basic Operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../atom-lists/atom/" class="md-nav__link">
        Atoms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../atom-lists/introduction_to_lists/" class="md-nav__link">
        Lists
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../atom-lists/list_operations/" class="md-nav__link">
        List Operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../atom-lists/hints_and_tricks/" class="md-nav__link">
        Hints and Tricks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Dictionary
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Dictionary" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Dictionary
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dict_table_func/1_dictionaries/" class="md-nav__link">
        Dictionaries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dict_table_func/2_operations_on_dictionaries/" class="md-nav__link">
        Operation on Dictionaries
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dict_table_func/3_tables/" class="md-nav__link">
        Tables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dict_table_func/4_functions/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dict_table_func/5_execution_control/" class="md-nav__link">
        Execution Control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dict_table_func/6_scripts/" class="md-nav__link">
        Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dict_table_func/7_debugging/" class="md-nav__link">
        Debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" type="checkbox" id="__nav_2_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_8">
          Q-SQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Q-SQL" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          Q-SQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Qsql/1_using_select_statements/" class="md-nav__link">
        Select
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Qsql/2_where_clause/" class="md-nav__link">
        Where
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Qsql/3_by_clause/" class="md-nav__link">
        By
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Qsql/4_functional_form/" class="md-nav__link">
        Functional Form
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../keywords_joins_adverbs_attributes/1_keywords/" class="md-nav__link">
        Keywords
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10" type="checkbox" id="__nav_2_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_10">
          Joins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Joins" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          Joins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../keywords_joins_adverbs_attributes/2_joins/" class="md-nav__link">
        Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../keywords_joins_adverbs_attributes/3_asof_window_joins/" class="md-nav__link">
        Asof-Windows
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../keywords_joins_adverbs_attributes/4_adverbs/" class="md-nav__link">
        Adverbs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../keywords_joins_adverbs_attributes/5_attributes/" class="md-nav__link">
        Attributes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../keywords_joins_adverbs_attributes/6_index_amend_apply/" class="md-nav__link">
        Index Amend
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_14" type="checkbox" id="__nav_2_14" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_14">
          IPC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="IPC" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_14">
          <span class="md-nav__icon md-icon"></span>
          IPC
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ipc_web_access/ipc_connecting/" class="md-nav__link">
        Connecting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ipc_web_access/ipc-sending-receiving/" class="md-nav__link">
        Send Receive
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ipc_web_access/kdb-via-web-browser/" class="md-nav__link">
        Web Browser
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_15" type="checkbox" id="__nav_2_15" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_15">
          File I/O
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="File I/O" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_15">
          <span class="md-nav__icon md-icon"></span>
          File I/O
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fileio/on-disk-tables/" class="md-nav__link">
        On disk tables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fileio/load-save-files/" class="md-nav__link">
        Load save files
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_16" type="checkbox" id="__nav_2_16" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_16">
          Data Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Analysis" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_16">
          <span class="md-nav__icon md-icon"></span>
          Data Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rack-align-pivot/" class="md-nav__link">
        Rack Align Pivot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compare-profile/" class="md-nav__link">
        Compare Profile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trade-analysis/" class="md-nav__link">
        Trade Analysis
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Map Reduce Parallelization
      </a>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Advent-of-Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advent-of-Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Advent-of-Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../aoc/23/" class="md-nav__link">
        Year2023
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/yogesh1314/yogesh1314-mkdocs/edit/master/docs/kdb-q/data-analysis/map-reduce-parallel.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<ul>
<li>When running queries against on-disk, partitioned databases, kdb+ will automatically apply map-reduce algorithms to some operations</li>
<li>These operations are executed in each partition seprately, then the results are aggregated to give the final answer</li>
<li>Operations: <code>count</code> , <code>first</code> , <code>last</code>, <code>sum</code>, <code>prd</code>, <code>min</code>, <code>max</code>, <code>distinct</code>, <code>avg</code>, <code>wsum</code>, <code>wavg</code>, <code>var</code>, <code>dev</code>, <code>cov</code>, <code>cor</code>, <code>med</code></li>
<li>Some operations are simple</li>
<li>Example: we want to calculate sum of a column across the date partition</li>
<li>Sub-operation is simply to calculate the sum of each partition individually and single result is returned from each partition, once all of the sum have been calculated from required partitions then final result is produced by sum of all the individual sums </li>
</ul>
<h1 id="without-slave-processes">Without Slave processes</h1>
<ul>
<li>Let's take example of <code>avg</code></li>
<li>query is <code>select avg size from trades where date within 2014.04.03 2014.04.04</code></li>
<li>and available partitions in hdb are : 2014.04.01, 2014.04.02, 2014.04.03, 2014.04.04 and 2014.04.05</li>
<li>Now sub-query which kdb+ send to each partition is something like : <code>select (sum size;count size) from trades</code> with result returned as <code>(220;6)</code>, <code>(600;30)</code>, .. </li>
<li>Once  all required results are returned, then final answer is calculated as sum of all size divided by sum of all counts</li>
<li>result: <code>(220+600)%(6+30) = 22.78</code></li>
</ul>
<h1 id="with-slave-processes">with slave processes</h1>
<ul>
<li>KDB+ can also do sub-operations in parallel </li>
<li>sample query : <code>select avg size from trades where date within 2014.04.03 2014.04.04</code> </li>
<li>then each query will be executed parallely on each partitions by using slave processes - using <code>-s</code> flag</li>
<li>once all the result are returned aggregation is done at the main thread </li>
<li>Sometimes this can result in slow peformance - in case all partitions are written on same disk then each slave will try to read disk at the same time which results in race conditions </li>
<li>the data can be spread across different file systems by having <code>par.txt</code> in root of HDB directory </li>
</ul>
<h1 id="with-slave-and-partxt">with slave and par.txt</h1>
<ul>
<li>Now for above example assuming HDB is parted in 2 disks - disk1 having partitions <code>2014.04.01</code>, <code>2014.04.02</code> and <code>2014.04.03</code> and disk2 having partitions <code>2014.04.04</code> and <code>2014.04.05</code></li>
<li>Now queries can run parallely on disk1 and disk2 by each slave processes </li>
<li>
<p>this will result in less contention and speed up of query </p>
</li>
<li>
<p>let's look at an example 
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>q)\l fakedb.q
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>USAGE: makedb[NUM QUOTES;NUM TRADES] eg makedb[100000;10000]
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>makedb1[NUM QUOTES;NUM TRADES;DATE;RANDOMISED COUNT FACTOR] eg makedb1[100000;10000;.z.d;.3]
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>makehdb[HDBDIR;NUM DAYS;APPROXIMATE NUM QUOTES PER DAY; APPROXIMATE NUM TRADES PER DAY] eg makehdb[`:hdb; 5; 100000; 10000]
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>makecsv[CSVDIR;NUM DAYS;NUM QUOTES;NUM TRADES]
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>q)makehdb[`:hdb;15;100000;10000000]
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>2022.12.26T16:51:16.614 saving data for date 2014.04.21 to :hdb
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>2022.12.26T16:51:17.077 saving data for date 2014.04.22 to :hdb
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>2022.12.26T16:51:17.431 saving data for date 2014.04.23 to :hdb
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>2022.12.26T16:51:17.720 saving data for date 2014.04.24 to :hdb
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>2022.12.26T16:51:18.132 saving data for date 2014.04.25 to :hdb
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>2022.12.26T16:51:18.389 saving data for date 2014.04.28 to :hdb
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>2022.12.26T16:51:18.733 saving data for date 2014.04.29 to :hdb
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>2022.12.26T16:51:19.082 saving data for date 2014.04.30 to :hdb
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>2022.12.26T16:51:19.407 saving data for date 2014.05.01 to :hdb
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>2022.12.26T16:51:19.763 saving data for date 2014.05.02 to :hdb
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>2022.12.26T16:51:20.110 saving data for date 2014.05.05 to :hdb
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>2022.12.26T16:51:20.422 saving data for date 2014.05.06 to :hdb
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>2022.12.26T16:51:20.804 saving data for date 2014.05.07 to :hdb
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>2022.12.26T16:51:21.183 saving data for date 2014.05.08 to :hdb
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>2022.12.26T16:51:21.569 saving data for date 2014.05.09 to :hdb
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>q)\l hdb
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>q)tables`
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>`depth`quotes`trades
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>q)select distinct date from trades
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>date
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>----------
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>2014.04.21
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>2014.04.22
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>2014.04.23
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>2014.04.24
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>2014.04.25
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>2014.04.28
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>2014.04.29
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>2014.04.30
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>2014.05.01
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>2014.05.02
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>2014.05.05
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>2014.05.06
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>2014.05.07
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>2014.05.08
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>2014.05.09
</code></pre></div></p>
</li>
<li>first let's take a sample query</li>
</ul>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>q)q)select sum `long$size, max price, vwap:size wavg price by sym, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>sym  minute| size     price vwap
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>-----------| -----------------------
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>AAPL 08:00 | 21303696 25.43 25.12335
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>AAPL 08:15 | 19856487 25.39 25.13909
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>AAPL 08:30 | 20348613 25.33 25.1434
</code></pre></div>
* all the above functions can be map-reduce by kdb+ 
* now if we time this query, we get: 
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>q)\t select sum `long$size, max price, vwap:size wavg price by sym, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>1791
</code></pre></div>
* now let's start another process with slaves </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>% q -s 4
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>KDB+ 4.0 2021.04.26 Copyright (C) 1993-2021 Kx Systems
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>m64/ 8(24)core 8192MB ranayk ykr-mbam1.local 127.0.0.1 EXPIRE 2023.07.24 1314.yogesh@gmail.com KXCE #73525
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>q)
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>q) // with slaves
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>q)\ts select sum `long$size, max price, vwap:size wavg price by sym, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>1511 133312
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>q)\ts select sum `long$size, max price, vwap:size wavg price by sym, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>468 127088
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>q)\ts select sum `long$size, max price, vwap:size wavg price by sym, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>441 128400
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>q)\ts select sum `long$size, max price, vwap:size wavg price by sym, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>443 128400
</code></pre></div>
* we can't really mix functions that q knows how to map-reduce with others
* let's define a function which kdb+ doesn't know how to map-reduce and include it with one kdb+ knows how to map-reduce
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>q)f:{max x}
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>q)select fprice: f[price], max price by sym from trades
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>sym | fprice                                                                                    price                ..
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>----| ---------------------------------------------------------------------------------------------------------------..
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>AAPL| 25.45 25.38 24.26 24.3  25.12 24.63 24.14 25.61 24.05 23.46 24.26 24.01 23.69 24.57 24.44 25.45 25.38 24.26 24...
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>CSCO| 36.64 36.51 37.44 37.98 37.84 37.04 36.75 36.38 36.46 35.54 35.83 35.81 36.13 37.28 37.74 36.64 36.51 37.44 37...
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>DELL| 29.95 29.77 29.98 30.56 30.92 31.48 30.38 30.69 30.54 29.72 28.43 28.97 27.86 28.37 26.48 29.95 29.77 29.98 30...
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>GOOG| 42.11 42.36 42.23 41.44 40.6  40.23 39.76 39.71 38.59 39.84 39.25 37.17 34.88 35.98 37.08 42.11 42.36 42.23 41...
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>IBM | 43.7  42.9  43.84 43.88 43.68 43.81 43.55 46.7  49.42 50.49 50.33 50.47 50.47 49.56 48.42 43.7  42.9  43.84 43...
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>MSFT| 36.49 35.84 35.97 36.12 35.01 33.75 32.44 32.76 35.34 35.87 34.56 34.77 35.51 36.93 37.81 36.49 35.84 35.97 36...
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>NOK | 31.95 31.91 33.69 33.88 33.66 33.15 33.57 36.02 35.91 36.58 35.33 36.01 36.32 36.35 36.66 31.95 31.91 33.69 33...
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>ORCL| 32.73 32.23 31.57 31.43 30.48 30.53 31.51 31.59 31.96 31.91 30.95 30.93 30.56 31.27 32.16 32.73 32.23 31.57 31...
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>YHOO| 35.61 35.22 34.3  34.24 34.89 33.31 33.69 33.65 31.51 30.41 29.28 29.79 30.45 30.28 30.19 35.61 35.22 34.3  34...
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>q)\ts select fprice: f[price], max price by sym from trades
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>512 151006784
</code></pre></div>
* no aggregation on the results from each partition 
* this  is because kdb+ parser doen't know how to aggregate the data
* we can do the aggregation manually 
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>q)update fprice: max each fprice, mprice: max each mprice from select fprice: f[price], mprice: max price by sym from trades
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>sym | fprice mprice
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>----| -------------
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>AAPL| 25.61  25.61
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>CSCO| 37.98  37.98
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>DELL| 31.48  31.48
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>GOOG| 42.36  42.36
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>IBM | 50.49  50.49
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>MSFT| 37.81  37.81
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>NOK | 36.66  36.66
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>ORCL| 32.73  32.73
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>YHOO| 35.61  35.61
</code></pre></div>
* Now it returns the desired result
* but it is not efficient or ideal</p>
<ul>
<li>Now if we put user-defined function second, then..
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>q)select mprice: max price, fprice: f[price] by sym from trades
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>&#39;price
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  [0]  select mprice: max price, fprice: f[price] by sym from trades
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>       ^
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>q))
</code></pre></div></li>
<li>query fails </li>
<li>reason for this: kdb+ only looks at first clause when aggreagating - here it sees it is map-reduce compatible </li>
<li>but it fails when it goes to 2nd clause which it doesn't know how to re-aggregate </li>
<li>few exceptions to this - if we query for single date, then..
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>q)select mprice: max price, fprice: f[price] by sym from trades where date=2014.04.21
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>sym | mprice fprice
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>----| -------------
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>AAPL| 25.45  25.45
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>CSCO| 36.64  36.64
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>DELL| 29.95  29.95
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>GOOG| 42.11  42.11
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>IBM | 43.7   43.7
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>MSFT| 36.49  36.49
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>NOK | 31.95  31.95
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>ORCL| 32.73  32.73
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>YHOO| 35.61  35.61
</code></pre></div></li>
<li>it works fine ! </li>
<li>this is because there is no need to aggregate as querying only 1 partition </li>
<li>or we group by partition type - then..
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>q)select mprice: max price, fprice: f[price] by date from trades
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>date      | mprice fprice
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>----------| -------------
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>2014.04.21| 43.7   43.7
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>2014.04.22| 42.9   42.9
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>2014.04.23| 43.84  43.84
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>2014.04.24| 43.88  43.88
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>2014.04.25| 43.68  43.68
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>2014.04.28| 43.81  43.81
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>2014.04.29| 43.55  43.55
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>2014.04.30| 46.7   46.7
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>2014.05.01| 49.42  49.42
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>2014.05.02| 50.49  50.49
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>2014.05.05| 50.33  50.33
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>2014.05.06| 50.47  50.47
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>2014.05.07| 50.47  50.47
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>2014.05.08| 49.56  49.56
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>2014.05.09| 48.42  48.42
</code></pre></div></li>
<li>also it works ! </li>
<li>but be careful on using the partition column first in group clause otherwise it fails again 
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>q)select mprice: max price, fprice: f[price] by date,sym from trades
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>date       sym | mprice fprice
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>---------------| -------------
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>2014.04.21 AAPL| 25.45  25.45
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>2014.04.21 CSCO| 36.64  36.64
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>2014.04.21 DELL| 29.95  29.95
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>2014.04.21 GOOG| 42.11  42.11
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>2014.04.21 IBM | 43.7   43.7
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>2014.04.21 MSFT| 36.49  36.49
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>q)select mprice: max price, fprice: f[price] by sym,date  from trades
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>&#39;price
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>  [0]  select mprice: max price, fprice: f[price] by sym,date  from trades
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>       ^
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>q))
</code></pre></div></li>
</ul>
<h1 id="query-re-structure-for-slaves">Query Re-structure for slaves</h1>
<ul>
<li>we  can re-structure queries to make use of slaves </li>
</ul>
<h2 id="no-slave">no slave</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>q)// price movement
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>q)\ts select 1 _ deltas price by sym, date, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>769 1099976496
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>q)\ts t1: select maxmove: max each price, avgmove: avg each price, avgabs: avg each abs each price, medmove: med each price by date, sym, minute from select 1 _ deltas price by sym, date, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>3157 1099976544
</code></pre></div>
<h2 id="with-slaves">with slaves</h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>q)\ts select 1 _ deltas price by sym, date, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>591 125488
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>q)\ts t1: select maxmove: max each price, avgmove: avg each price, avgabs: avg each abs each price, medmove: med each price by date, sym, minute from select 1 _ deltas price by sym, date, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>2077 1795984
</code></pre></div>
* little speed up but we can further optimise it 
* in above query - slave thread were only processing the first part of the query and second part of calculating max, avg, med were done in main thread 
* we can move whole calculation to slave as well </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>q)\ts select (max;avg;{avg abs x};med)@\:1 _ deltas price by sym, date, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>1327 120048
</code></pre></div>
* now whole operation is done at slave side and we see significant speed up - about twice as fast </p>
<ul>
<li>now we can try optimised query in process with no slave, then..</li>
<li>it is taking approx same time 
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>q)\ts select (max;avg;{avg abs x};med)@\:1 _ deltas price by sym, date, 15 xbar time.minute from trades where date within 2014.04.21 2014.04.22
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>2450 939564736
</code></pre></div></li>
</ul>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../trade-analysis/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Trade Analysis" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Trade Analysis
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../aoc/23/" class="md-footer__link md-footer__link--next" aria-label="Next: Year2023" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Year2023
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/yogesh1314" target="_blank" rel="noopener" title="Yogesh Rana on github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="https://in.linkedin.com/in/yogesh1314" target="_blank" rel="noopener" title="Yogesh Rana on linkedin" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["header.autohide", "navigation.top", "navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.960e086b.min.js"></script>
      
        <script src="../../../scripts/prism.js"></script>
      
        <script src="../../../scripts/jquery-3.6.3.min.js"></script>
      
    
  </body>
</html>